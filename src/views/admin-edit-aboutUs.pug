extends admin-layout
include includes/mixins

block jumbo-desc
  h3 Edit About Us

block admin-content

  link(rel='stylesheet', href='https://cdn.quilljs.com/1.2.6/quill.snow.css')
  script(type="text/javascript" language="javascript" rel='javascript' src='/js/nicEdit.js').

  script(rel='javascript' src='/js/showdown.min.js')
  .container-fluid
    form(action= "/admin/edit/aboutUs"  method="post")
      div(id='editor-container' style={'height': '500px'})
          
      .form-group
        button.btn.btn-default(name='save' type='submit' value='Save' role='submit' id='save-button') Save
    script(rel='javascript' src='/js/showdown.min.js')
    script(rel='javascript' src='/js/mdEditor.js')
    script(rel='javascript' src='https://cdn.quilljs.com/1.2.6/quill.js')
    script(type='text/javascript').
      content="#{content}"
      
      let correctContent = content.replace(/&quot;/g, '"');
      correctContent = correctContent.replace(/(?:\r\n|\r|\n)/g, '\\n');
        
      const toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
        ['blockquote', 'code-block'],
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
        [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
        [{ 'direction': 'rtl' }],                         // text direction
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
        [ 'link', 'image', 'video', 'formula' ],          // add's image support
        [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
        [{ 'align': [] }],
        ['clean']                                         // remove formatting button
      ];

      const quill = new Quill('#editor-container', {
        modules: {
          toolbar: toolbarOptions,
        },
        placeholder: 'Write your content here...',
        theme: 'snow'  // or 'bubble'
      });
      
      quill.setContents(JSON.parse(correctContent));
      
      $('form').on('submit', function(e) {
        e.preventDefault();
      });
      
      $('#save-button').on('click', function(e) {
        console.log('saving');
        
        const content = JSON.stringify(quill.getContents());
        
        $.ajax({
          url: '/admin/edit/AboutUs',
          type: 'POST',
          data: {
            content
          },
          success: function(data) {
            console.log('changes to about us saved successfully');
            window.location = data.redirect;
          }
        })
      });
